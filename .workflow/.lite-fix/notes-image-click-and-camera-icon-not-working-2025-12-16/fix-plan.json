{
  "summary": "ä¿®å¤ç¬”è®°é¡µé¢ä¸­å›¾ç‰‡ç‚¹å‡»å’Œç›¸æœºå›¾æ ‡æ— å“åº”çš„é—®é¢˜ã€‚æ ¹æœ¬åŸå› æ˜¯openImageGalleryå‡½æ•°å®šä¹‰åœ¨é¡µé¢åº•éƒ¨,å¯¼è‡´inline onclickæ‰§è¡Œæ—¶å‡½æ•°æœªå®šä¹‰æˆ–è¢«Alpine.jsè¦†ç›–ã€‚ä¿®å¤æ–¹æ¡ˆæ˜¯å°†æ‰€æœ‰å›¾ç‰‡æŸ¥çœ‹å™¨å‡½æ•°æå‰åˆ°<head>ä¸­,ç¡®ä¿å…¨å±€æ—©æœŸå¯ç”¨ã€‚",
  "root_cause": "templates/notes.htmlä¸­çš„openImageGalleryå‡½æ•°å®šä¹‰åœ¨åº•éƒ¨<script>æ ‡ç­¾(line 335-418),ä½†templates/components/note_card.htmlä¸­çš„inline onclickå¤„ç†å™¨(line 14,17)åœ¨é¡µé¢æ¸²æŸ“æ—¶ç«‹å³è°ƒç”¨è¯¥å‡½æ•°,æ­¤æ—¶å‡½æ•°å¯èƒ½å°šæœªå®šä¹‰æˆ–è¢«Alpine.jsè¦†ç›–,å¯¼è‡´ç‚¹å‡»äº‹ä»¶æ— å“åº”ã€‚",
  "strategy": "immediate_patch",
  "tasks": [
    {
      "id": "FIX1",
      "title": "å°†å›¾ç‰‡æŸ¥çœ‹å™¨å‡½æ•°æå‰åˆ°headä¸­",
      "scope": "templates/notes.html",
      "action": "Update",
      "description": "å°†openImageGalleryã€closeGalleryModalã€showGalleryImageã€changeGalleryImageã€handleGalleryKeyboardç­‰å‡½æ•°åŠå…¨å±€å˜é‡ä»åº•éƒ¨<script>ç§»åˆ°<head>ä¸­çš„æ—©æœŸ<script>æ ‡ç­¾,ç¡®ä¿åœ¨DOMæ¸²æŸ“å‰å…¨å±€å¯ç”¨",
      "modification_points": [
        {
          "file": "templates/notes.html",
          "target": "lines 331-418 (current script block)",
          "change": "ç§»åŠ¨å›¾ç‰‡æŸ¥çœ‹å™¨å‡½æ•°åˆ°<head>ä¸­æ–°å¢çš„<script>æ ‡ç­¾"
        },
        {
          "file": "templates/notes.html",
          "target": "<head> section (before closing </head>)",
          "change": "æ·»åŠ æ–°çš„<script>æ ‡ç­¾åŒ…å«æ‰€æœ‰galleryç›¸å…³å‡½æ•°"
        }
      ],
      "implementation": [
        "åœ¨templates/notes.htmlçš„</head>å‰æ·»åŠ æ–°çš„<script>æ ‡ç­¾",
        "å°†window.galleryImageså’Œwindow.currentGalleryIndexå˜é‡åˆå§‹åŒ–ä»£ç ç§»åˆ°æ–°scriptä¸­",
        "å°†window.openImageGalleryã€window.closeGalleryModalç­‰5ä¸ªå‡½æ•°å®šä¹‰ç§»åˆ°æ–°scriptä¸­",
        "åˆ é™¤åº•éƒ¨<script>ä¸­çš„è¿™äº›å‡½æ•°å®šä¹‰(line 331-418)",
        "ä¿ç•™å…¶ä»–å‡½æ•°(toggleFavorite, toggleTextç­‰)åœ¨åº•éƒ¨scriptä¸­"
      ],
      "verification": [
        "åœ¨æµè§ˆå™¨Consoleä¸­æ£€æŸ¥window.openImageGalleryæ˜¯å¦åœ¨DOMContentLoadedå‰å·²å®šä¹‰",
        "ç‚¹å‡»ç¬”è®°å¡ç‰‡ä¸­çš„å›¾ç‰‡,éªŒè¯galleryModalæ­£å¸¸æ‰“å¼€",
        "ç‚¹å‡»å³ä¸Šè§’ç›¸æœºå›¾æ ‡(ğŸ“· N),éªŒè¯galleryModalæ­£å¸¸æ‰“å¼€å¹¶æ˜¾ç¤ºå¤šå¼ å›¾ç‰‡"
      ],
      "reference": {
        "pattern": "early-global-function-definition",
        "files": [
          "templates/notes.html:299-323 (openImageModalæˆåŠŸæ¡ˆä¾‹)"
        ],
        "examples": "å‚è€ƒopenImageModalçš„windowç»‘å®šæ¨¡å¼,è¯¥å‡½æ•°å·¥ä½œæ­£å¸¸å› ä¸ºå®šä¹‰åœ¨ç›¸å¯¹è¾ƒæ—©çš„ä½ç½®"
      },
      "risk": "low"
    },
    {
      "id": "FIX2",
      "title": "æ·»åŠ Consoleæ—¥å¿—ç”¨äºè°ƒè¯•éªŒè¯",
      "scope": "templates/notes.html",
      "action": "Add",
      "description": "åœ¨openImageGalleryå‡½æ•°å¼€å¤´æ·»åŠ console.log,ä¾¿äºè°ƒè¯•å’ŒéªŒè¯å‡½æ•°æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨",
      "modification_points": [
        {
          "file": "templates/notes.html",
          "target": "openImageGallery function (after move to <head>)",
          "change": "æ·»åŠ console.log('Opening gallery for note:', noteId, mediaPaths)"
        }
      ],
      "implementation": [
        "åœ¨window.openImageGalleryå‡½æ•°ç¬¬ä¸€è¡Œæ·»åŠ console.log",
        "è®°å½•noteIdå’ŒmediaPathså‚æ•°,ä¾¿äºéªŒè¯å‡½æ•°è°ƒç”¨å’Œå‚æ•°ä¼ é€’"
      ],
      "verification": [
        "æ‰“å¼€æµè§ˆå™¨Console",
        "ç‚¹å‡»å›¾ç‰‡åæŸ¥çœ‹Consoleæ˜¯å¦è¾“å‡º'Opening gallery for note: X'",
        "éªŒè¯å‚æ•°æ­£ç¡®ä¼ é€’"
      ],
      "depends_on": ["FIX1"],
      "risk": "low"
    }
  ],
  "focus_paths": [
    "templates/notes.html",
    "templates/components/note_card.html",
    "templates/components/modals.html"
  ],
  "test_strategy": {
    "scope": "smoke",
    "specific_tests": [],
    "manual_verification": [
      "è®¿é—®/notesé¡µé¢,ç‚¹å‡»åŒ…å«å•å¼ å›¾ç‰‡çš„ç¬”è®°,éªŒè¯å•å›¾æŸ¥çœ‹å™¨æ­£å¸¸å·¥ä½œ(openImageModal)",
      "ç‚¹å‡»åŒ…å«å¤šå¼ å›¾ç‰‡çš„ç¬”è®°å¡ç‰‡å›¾ç‰‡,éªŒè¯å›¾ç‰‡ç”»å»Šæ­£å¸¸æ‰“å¼€",
      "ç‚¹å‡»å³ä¸Šè§’ç›¸æœºå›¾æ ‡(ğŸ“· N),éªŒè¯å›¾ç‰‡ç”»å»Šæ­£å¸¸æ‰“å¼€å¹¶æ˜¾ç¤ºå¤šå¼ å›¾ç‰‡",
      "åœ¨å›¾ç‰‡ç”»å»Šä¸­ç‚¹å‡»å·¦å³åˆ‡æ¢æŒ‰é’®,éªŒè¯å›¾ç‰‡åˆ‡æ¢åŠŸèƒ½æ­£å¸¸",
      "æŒ‰ESCé”®å…³é—­å›¾ç‰‡ç”»å»Š,éªŒè¯å…³é—­åŠŸèƒ½æ­£å¸¸",
      "ç‚¹å‡»ç¼©ç•¥å›¾åˆ‡æ¢å›¾ç‰‡,éªŒè¯ç¼©ç•¥å›¾å¯¼èˆªåŠŸèƒ½æ­£å¸¸"
    ]
  },
  "estimated_time": "15 minutes",
  "recommended_execution": "Agent",
  "severity": "Medium",
  "risk_level": "low",
  "_metadata": {
    "timestamp": "2025-12-16T08:10:00Z",
    "source": "direct-planning",
    "planning_mode": "direct",
    "diagnosis_angles": [
      "event-handling",
      "state-management"
    ],
    "duration_seconds": 60
  }
}