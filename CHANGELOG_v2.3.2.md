# Changelog v2.3.2

## 发布日期: 2024

### 🐛 Bug 修复

#### 1. 搜索面板自动弹出问题
**问题**: 刷新网页时，搜索/筛选框会自动弹出。

**修复**: 在 `.search-panel` CSS 类中添加 `display: none;` 属性。

**影响文件**:
- `templates/notes.html` - Line 212

**用户体验改进**:
- ✅ 页面加载时搜索面板默认隐藏
- ✅ 只有点击搜索图标时才会弹出
- ✅ 更清爽的页面初始状态

---

#### 2. 群组/频道中无法使用机器人
**问题**: 机器人在群组/频道中通过 `@机器人 + 链接` 方式无法使用转发和批量下载功能。

**修复**: 修改消息过滤器，允许处理提及机器人和回复机器人的消息。

**修改前**:
```python
@bot.on_message(filters.text & filters.private & ~filters.command([...]))
```

**修改后**:
```python
@bot.on_message(filters.text & (filters.private | filters.mentioned | filters.reply) & ~filters.command([...]))
```

**影响文件**:
- `main.py` - Line 1347

**用户体验改进**:
- ✅ 私聊中正常工作（原有功能）
- ✅ 群组中可以通过 `@bot_username https://t.me/...` 使用
- ✅ 可以回复机器人的消息后发送链接
- ✅ 兼容隐私模式（Privacy Mode）

---

### 📋 技术细节

#### 搜索面板修复
- **修改类型**: CSS 样式修复
- **向后兼容**: 是
- **需要数据迁移**: 否
- **需要重启**: 是（仅重启 Web 应用）

#### 群组支持修复
- **修改类型**: 消息过滤器逻辑
- **向后兼容**: 是（私聊功能完全保留）
- **需要数据迁移**: 否
- **需要重启**: 是（需要重启机器人）

---

### 🧪 测试

#### 测试脚本
新增测试脚本 `test_fixes.py`，验证两个修复：
- ✅ 搜索面板默认隐藏
- ✅ 消息过滤器支持群组

#### 测试命令
```bash
python3 test_fixes.py
```

#### 预期结果
```
✅ 测试 1 (搜索面板默认隐藏): 通过
✅ 测试 2 (群组消息处理): 通过
```

---

### 📖 文档更新

#### 新增文档
- `BUG_FIXES.md` - 详细的 Bug 修复说明
- `test_fixes.py` - 自动化测试脚本
- `CHANGELOG_v2.3.2.md` - 本文件

#### 更新文档
- `README.md` - 添加 v2.3.2 版本说明
- `README.zh-CN.md` - 添加 v2.3.2 中文版本说明

---

### 🔄 升级说明

#### 升级步骤
1. 拉取最新代码：
   ```bash
   git pull origin main
   ```

2. 重启服务：
   ```bash
   # Docker 用户
   docker-compose restart
   
   # 或手动重启
   pkill -f "python.*main.py"
   python3 main.py &
   ```

3. 验证修复：
   ```bash
   python3 test_fixes.py
   ```

#### 注意事项
- ⚠️ 无需修改配置文件
- ⚠️ 无需迁移数据
- ⚠️ 现有监控任务不受影响
- ⚠️ 如需在群组使用，建议在 BotFather 中关闭隐私模式

---

### 📊 影响范围

#### 影响的功能
- ✅ Web 界面搜索体验
- ✅ 群组/频道中的机器人使用

#### 不受影响的功能
- ✅ 监控任务
- ✅ 记录模式
- ✅ 过滤器功能
- ✅ 批量下载
- ✅ 所有现有配置

---

### 🎯 使用场景扩展

#### 群组使用方法

**场景 1: 团队协作**
```
在团队群组中:
用户: @bot_username https://t.me/source_channel/123
机器人: [转发消息]
```

**场景 2: 快速分享**
```
在讨论群中:
用户A: 这个链接的内容是什么？
用户B: @bot_username https://t.me/restricted_channel/456
机器人: [显示受限内容]
```

**场景 3: 批量处理**
```
在工作群中:
用户: @bot_username https://t.me/channel/100-120
机器人: [批量下载 100-120 消息]
```

---

### 🙏 致谢

感谢用户反馈这些重要的使用问题，帮助我们改进用户体验！

---

### 📞 问题反馈

如发现任何问题，欢迎：
- 提交 GitHub Issue
- 参与 GitHub Discussions
- 联系项目维护者

---

**版本**: v2.3.2  
**发布日期**: 2024  
**测试状态**: ✅ 已通过所有测试  
**生产就绪**: ✅ 是
