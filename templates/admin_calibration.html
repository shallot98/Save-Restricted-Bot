<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªåŠ¨æ ¡å‡†è®¾ç½® - Telegram ç¬”è®°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title h1 {
            color: #333;
            font-size: 28px;
        }

        .header-icon {
            font-size: 40px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #555;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 22px;
        }

        .card p {
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            color: #555;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        input[type="number"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            border: 1px solid #fcc;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .info-box p {
            color: #333;
            margin: 5px 0;
            font-size: 14px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .hint {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <span class="header-icon">ğŸ”§</span>
                <h1>è‡ªåŠ¨æ ¡å‡†è®¾ç½®</h1>
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <a href="/admin/calibration/queue" class="btn btn-secondary">ğŸ“‹ æŸ¥çœ‹é˜Ÿåˆ—</a>
                <a href="/admin" class="btn btn-secondary">â† è¿”å›ç®¡ç†</a>
            </div>
        </div>

        {% if success %}
        <div class="card">
            <div class="success-message">
                âœ“ {{ success }}
            </div>
        </div>
        {% endif %}

        {% if error %}
        <div class="card">
            <div class="error-message">
                âœ— {{ error }}
            </div>
        </div>
        {% endif %}

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        {% if stats %}
        <div class="card">
            <h2>ğŸ“Š æ ¡å‡†ä»»åŠ¡ç»Ÿè®¡</h2>
            <p>å½“å‰æ ¡å‡†ä»»åŠ¡çŠ¶æ€æ¦‚è§ˆ</p>
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-number">{{ stats.total }}</div>
                    <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">{{ stats.by_status.get('pending', 0) + stats.by_status.get('retrying', 0) }}</div>
                    <div class="stat-label">å¾…å¤„ç†</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">{{ stats.by_status.get('success', 0) }}</div>
                    <div class="stat-label">å·²æˆåŠŸ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">{{ stats.by_status.get('failed', 0) }}</div>
                    <div class="stat-label">å·²å¤±è´¥</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- é…ç½®è¡¨å• -->
        <div class="card">
            <h2>âš™ï¸ æ ¡å‡†é…ç½®</h2>
            <p>é…ç½®è‡ªåŠ¨æ ¡å‡†çš„è¡Œä¸ºå’Œå‚æ•°</p>

            <form method="POST" action="/admin/calibration">
                <!-- å¯ç”¨å¼€å…³ -->
                <div class="form-group">
                    <label>å¯ç”¨è‡ªåŠ¨æ ¡å‡†</label>
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" name="enabled" {% if config.enabled %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span style="color: #666;">{{ 'å·²å¯ç”¨' if config.enabled else 'å·²ç¦ç”¨' }}</span>
                    </div>
                    <div class="hint">å¼€å¯åï¼Œæ–°æ·»åŠ çš„ç¬”è®°å°†è‡ªåŠ¨åŠ å…¥æ ¡å‡†é˜Ÿåˆ—</div>
                </div>

                <!-- è¿‡æ»¤æ¨¡å¼ -->
                <div class="form-group">
                    <label for="filter_mode">è¿‡æ»¤æ¨¡å¼</label>
                    <select name="filter_mode" id="filter_mode">
                        <option value="empty_only" {% if config.filter_mode == 'empty_only' %}selected{% endif %}>ä»…æ ¡å‡† dn ä¸ºç©ºçš„ç¬”è®°</option>
                        <option value="all" {% if config.filter_mode == 'all' %}selected{% endif %}>æ ¡å‡†æ‰€æœ‰ç¬”è®°</option>
                    </select>
                    <div class="hint">é€‰æ‹©å“ªäº›ç¬”è®°éœ€è¦è¿›è¡Œè‡ªåŠ¨æ ¡å‡†</div>
                </div>

                <!-- é¦–æ¬¡å»¶è¿Ÿ -->
                <div class="form-group">
                    <label for="first_delay">é¦–æ¬¡æ ¡å‡†å»¶è¿Ÿï¼ˆç§’ï¼‰</label>
                    <input type="number" name="first_delay" id="first_delay" value="{{ config.first_delay }}" min="60" max="3600" inputmode="numeric" required>
                    <div class="hint">ç¬”è®°æ·»åŠ åå¤šä¹…è¿›è¡Œé¦–æ¬¡æ ¡å‡†ï¼ˆé»˜è®¤600ç§’ = 10åˆ†é’Ÿï¼‰</div>
                </div>

                <!-- é‡è¯•å»¶è¿Ÿ -->
                <div class="form-group">
                    <label for="retry_delay_1">ç¬¬1æ¬¡é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰</label>
                    <input type="number" name="retry_delay_1" id="retry_delay_1" value="{{ config.retry_delay_1 }}" min="60" max="86400" inputmode="numeric" required>
                    <div class="hint">é¦–æ¬¡å¤±è´¥åçš„é‡è¯•å»¶è¿Ÿï¼ˆé»˜è®¤3600ç§’ = 1å°æ—¶ï¼‰</div>
                </div>

                <div class="form-group">
                    <label for="retry_delay_2">ç¬¬2æ¬¡é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰</label>
                    <input type="number" name="retry_delay_2" id="retry_delay_2" value="{{ config.retry_delay_2 }}" min="60" max="86400" inputmode="numeric" required>
                    <div class="hint">ç¬¬äºŒæ¬¡å¤±è´¥åçš„é‡è¯•å»¶è¿Ÿï¼ˆé»˜è®¤14400ç§’ = 4å°æ—¶ï¼‰</div>
                </div>

                <div class="form-group">
                    <label for="retry_delay_3">ç¬¬3æ¬¡é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰</label>
                    <input type="number" name="retry_delay_3" id="retry_delay_3" value="{{ config.retry_delay_3 }}" min="60" max="86400" inputmode="numeric" required>
                    <div class="hint">ç¬¬ä¸‰æ¬¡å¤±è´¥åçš„é‡è¯•å»¶è¿Ÿï¼ˆé»˜è®¤28800ç§’ = 8å°æ—¶ï¼‰</div>
                </div>

                <!-- æœ€å¤§é‡è¯•æ¬¡æ•° -->
                <div class="form-group">
                    <label for="max_retries">æœ€å¤§é‡è¯•æ¬¡æ•°</label>
                    <input type="number" name="max_retries" id="max_retries" value="{{ config.max_retries }}" min="1" max="10" inputmode="numeric" required>
                    <div class="hint">è¶…è¿‡æ­¤æ¬¡æ•°ä»å¤±è´¥çš„ç¬”è®°å°†è¢«æ ‡è®° #*ï¼ˆé»˜è®¤3æ¬¡ï¼‰</div>
                </div>

                <!-- å¹¶å‘é™åˆ¶ -->
                <div class="form-group">
                    <label for="concurrent_limit">å¹¶å‘å¤„ç†æ•°é‡</label>
                    <input type="number" name="concurrent_limit" id="concurrent_limit" value="{{ config.concurrent_limit }}" min="1" max="20" inputmode="numeric" required>
                    <div class="hint">æ¯æ¬¡æ‰¹é‡å¤„ç†çš„æœ€å¤§ä»»åŠ¡æ•°ï¼ˆé»˜è®¤5ä¸ªï¼‰</div>
                </div>

                <!-- å•ä¸ªè¶…æ—¶ -->
                <div class="form-group">
                    <label for="timeout_per_magnet">å•ä¸ªç£åŠ›è¶…æ—¶ï¼ˆç§’ï¼‰</label>
                    <input type="number" name="timeout_per_magnet" id="timeout_per_magnet" value="{{ config.timeout_per_magnet }}" min="10" max="120" inputmode="numeric" required>
                    <div class="hint">å•ä¸ªç£åŠ›é“¾æ¥çš„æ ¡å‡†è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤30ç§’ï¼‰</div>
                </div>

                <!-- æ‰¹é‡è¶…æ—¶ -->
                <div class="form-group">
                    <label for="batch_timeout">æ‰¹é‡å¤„ç†æ€»è¶…æ—¶ï¼ˆç§’ï¼‰</label>
                    <input type="number" name="batch_timeout" id="batch_timeout" value="{{ config.batch_timeout }}" min="60" max="1800" inputmode="numeric" required>
                    <div class="hint">æ‰¹é‡å¤„ç†çš„æ€»è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤300ç§’ = 5åˆ†é’Ÿï¼‰</div>
                </div>

                <div class="info-box">
                    <p>ğŸ’¡ <strong>å·¥ä½œåŸç†è¯´æ˜ï¼š</strong></p>
                    <p>1. ç¬”è®°æ·»åŠ åï¼Œç»è¿‡"é¦–æ¬¡å»¶è¿Ÿ"æ—¶é—´è¿›å…¥æ ¡å‡†é˜Ÿåˆ—</p>
                    <p>2. ç³»ç»Ÿæ¯60ç§’æ£€æŸ¥ä¸€æ¬¡å¾…å¤„ç†ä»»åŠ¡ï¼ŒæŒ‰"å¹¶å‘é™åˆ¶"æ‰¹é‡å¤„ç†</p>
                    <p>3. å¤±è´¥çš„ä»»åŠ¡æŒ‰æ¸è¿›å¼å»¶è¿Ÿé‡è¯•ï¼Œç›´åˆ°è¾¾åˆ°"æœ€å¤§é‡è¯•æ¬¡æ•°"</p>
                    <p>4. è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°çš„ç¬”è®°ä¼šåœ¨å¼€å¤´æ·»åŠ  #* æ ‡è®°</p>
                </div>

                <button type="submit" class="btn btn-primary">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </form>
        </div>
    </div>
</body>
</html>
