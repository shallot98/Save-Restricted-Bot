!function(){"use strict";const n={connectionType:null,lastDetectionTime:0,CACHE_DURATION:3e4,TIMEOUTS:{"slow-2g":15e3,"2g":1e4,"3g":8e3,"4g":5e3,wifi:5e3,unknown:5e3},RETRY_COUNTS:{"slow-2g":3,"2g":3,"3g":2,"4g":1,wifi:1,unknown:1},detectConnectionType:function(){const n=Date.now();if(this.connectionType&&n-this.lastDetectionTime<this.CACHE_DURATION)return this.connectionType;if(navigator.connection&&navigator.connection.effectiveType){const n=navigator.connection.effectiveType;"wifi"===navigator.connection.type?this.connectionType="wifi":this.connectionType=n}else this.connectionType="4g";return this.lastDetectionTime=n,this.connectionType},getApiTimeout:function(){const n=this.detectConnectionType();return this.TIMEOUTS[n]||this.TIMEOUTS.unknown},getRetryCount:function(){const n=this.detectConnectionType();return this.RETRY_COUNTS[n]||this.RETRY_COUNTS.unknown},isOnline:function(){return navigator.onLine},fetchWithRetry:async function(n,e,t){if(!this.isOnline())throw new Error("\u7f51\u7edc\u8fde\u63a5\u4e0d\u53ef\u7528,\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u8bbe\u7f6e");const o=this.getApiTimeout(),i=null!=t?t:this.getRetryCount();for(let t=0;t<=i;t++)try{const t=new AbortController,i=setTimeout(function(){t.abort()},o),c=Object.assign({},e||{},{signal:t.signal}),s=await fetch(n,c);if(clearTimeout(i),s.status>=400&&s.status<500)return s;if(s.ok)return s;throw new Error("HTTP "+s.status+": "+s.statusText)}catch(n){const e=t===i;if("AbortError"===n.name){if(console.log("\u8bf7\u6c42\u8d85\u65f6 (\u5c1d\u8bd5 "+(t+1)+"/"+(i+1)+")"),!e){const n=Math.min(1e3*Math.pow(2,t),1e4);console.log("\u7b49\u5f85 "+n+"ms \u540e\u91cd\u8bd5..."),await this.sleep(n);continue}throw new Error("\u8bf7\u6c42\u8d85\u65f6 ("+o+"ms),\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5")}if(n instanceof TypeError){if(console.log("\u7f51\u7edc\u9519\u8bef (\u5c1d\u8bd5 "+(t+1)+"/"+(i+1)+")"),!e){const n=Math.min(1e3*Math.pow(2,t),1e4);console.log("\u7b49\u5f85 "+n+"ms \u540e\u91cd\u8bd5..."),await this.sleep(n);continue}throw new Error("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25,\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5")}throw n}},sleep:function(n){return new Promise(function(e){setTimeout(e,n)})},init:function(){window.addEventListener("online",function(){console.log("\u7f51\u7edc\u5df2\u8fde\u63a5"),n.hideOfflineBanner()}),window.addEventListener("offline",function(){console.log("\u7f51\u7edc\u5df2\u65ad\u5f00"),n.showOfflineBanner()}),navigator.connection&&navigator.connection.addEventListener("change",function(){n.connectionType=null,console.log("\u7f51\u7edc\u8fde\u63a5\u7c7b\u578b\u53d8\u66f4:",n.detectConnectionType())}),this.isOnline()||this.showOfflineBanner(),console.log("NetworkManager initialized - Connection:",this.detectConnectionType())},showOfflineBanner:function(){let n=document.getElementById("offlineBanner");n||(n=document.createElement("div"),n.id="offlineBanner",n.style.cssText="position: fixed; top: 0; left: 0; right: 0; background: #f44336; color: white; padding: 12px; text-align: center; z-index: 10000; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);",n.textContent="\u7f51\u7edc\u8fde\u63a5\u4e0d\u53ef\u7528 - \u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u8bbe\u7f6e",document.body.insertBefore(n,document.body.firstChild))},hideOfflineBanner:function(){const n=document.getElementById("offlineBanner");n&&n.remove()}};window.NetworkManager=n}();