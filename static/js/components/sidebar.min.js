!function(){"use strict";const t={sidebarOpen:!1,viewportWidth:window.innerWidth,isMobile:window.innerWidth<768,touchState:{startX:0,startY:0,currentX:0,currentY:0,startTime:0,endTime:0,isSwiping:!1},clickSuppressed:!1,STORAGE_KEY:"mobileUIState",init:function(){this.viewportWidth=window.innerWidth,this.isMobile=this.viewportWidth<768;try{const t=window.StorageManager.getItem(this.STORAGE_KEY,null);t?this.isMobile?(this.sidebarOpen=!1,console.log("Mobile mode: sidebar closed by default")):(this.sidebarOpen=!1!==t.sidebarOpen,console.log("Desktop mode: loaded saved sidebar state:",this.sidebarOpen)):(this.isMobile?(this.sidebarOpen=!1,console.log("First visit on mobile: sidebar closed by default")):(this.sidebarOpen=!0,console.log("First visit on desktop: sidebar open by default")),this.persist())}catch(t){console.warn("Failed to load saved UI state:",t),this.sidebarOpen=!this.isMobile}if(this.syncDOM(),this.verifyStateSync(),this.initTouchEvents(),this.initVirtualViewport(),this.isMobile){var t=this;setTimeout(function(){t.showMobileHint()},1e3)}console.log("MobileUIState initialized:",this.getState())},getState:function(){return{sidebarOpen:this.sidebarOpen,viewportWidth:this.viewportWidth,isMobile:this.isMobile}},toggleSidebar:function(){this.sidebarOpen=!this.sidebarOpen,this.syncDOM(),this.persist(),console.log("Sidebar toggled:",this.sidebarOpen)},updateViewport:function(){const t=this.isMobile;this.viewportWidth=window.innerWidth,this.isMobile=this.viewportWidth<768,t&&!this.isMobile?this.sidebarOpen||(this.sidebarOpen=!0,console.log("Desktop mode: auto-opening sidebar")):!t&&this.isMobile&&(this.sidebarOpen=!1,console.log("Mobile mode: closing sidebar")),this.syncDOM(),this.persist()},syncDOM:function(){const t=document.getElementById("sidebar"),e=document.getElementById("sidebarOverlay");if(!t)return void console.warn("Sidebar element not found, cannot sync DOM");this.isMobile?(t.classList.remove("collapsed"),this.sidebarOpen?(t.classList.add("mobile-open"),e&&e.classList.add("active")):(t.classList.remove("mobile-open"),e&&e.classList.remove("active"))):(t.classList.remove("mobile-open"),e&&e.classList.remove("active"),this.sidebarOpen?t.classList.remove("collapsed"):t.classList.add("collapsed"));const i=document.getElementById("sidebarToggleText");i&&(i.textContent=this.sidebarOpen?"\u6536\u8d77\u4fa7\u8fb9\u680f":"\u5c55\u5f00\u4fa7\u8fb9\u680f"),console.log("DOM synced - Mode:",this.isMobile?"mobile":"desktop","Open:",this.sidebarOpen,"Classes:",t.className)},persist:function(){const t={sidebarOpen:this.sidebarOpen,timestamp:Date.now()},e=window.StorageManager.setItem(this.STORAGE_KEY,t);return e?console.log("State persisted to localStorage:",t):console.error("Failed to persist state to localStorage"),e},verifyStateSync:function(){try{const t=window.StorageManager.getItem(this.STORAGE_KEY,null);if(t){const e=t.sidebarOpen===this.sidebarOpen;return e?console.log("State verification passed - Memory and storage are in sync"):(console.warn("State mismatch detected!","Memory:",this.sidebarOpen,"Storage:",t.sidebarOpen),this.persist()),e}}catch(t){return console.error("State verification failed:",t),!1}return!0},initTouchEvents:function(){const e=document.getElementById("sidebar");e&&(e.addEventListener("touchstart",function(e){const i=e.touches[0];t.touchState.startX=i.clientX,t.touchState.startY=i.clientY,t.touchState.currentX=i.clientX,t.touchState.currentY=i.clientY,t.touchState.startTime=Date.now(),t.touchState.isSwiping=!1},{passive:!0}),e.addEventListener("touchmove",function(e){if(0===e.touches.length)return;const i=e.touches[0];t.touchState.currentX=i.clientX,t.touchState.currentY=i.clientY,t.touchState.isSwiping=!0},{passive:!0}),e.addEventListener("touchend",function(e){t.touchState.endTime=Date.now(),t.handleSwipeGesture()},{passive:!0}),console.log("Touch event listeners initialized for sidebar"))},handleSwipeGesture:function(){if(!this.isMobile||!this.sidebarOpen||!this.touchState.isSwiping)return void(this.touchState.isSwiping=!1);const e=this.touchState.currentX-this.touchState.startX,i=this.touchState.currentY-this.touchState.startY,s=this.touchState.endTime-this.touchState.startTime,o=Math.abs(e)/s;Math.abs(e)>Math.abs(i)&&(e<-50||o>.3&&e<0)&&(console.log("Swipe detected: deltaX="+e.toFixed(1)+"px, velocity="+o.toFixed(3)+"px/ms"),this.toggleSidebar(),this.clickSuppressed=!0,setTimeout(function(){t.clickSuppressed=!1},300)),this.touchState.isSwiping=!1},initVirtualViewport:function(){window.visualViewport?(visualViewport.addEventListener("resize",function(){const t=visualViewport.height;if(window.innerHeight-t>150){const t=document.activeElement;!t||"TEXTAREA"!==t.tagName&&"INPUT"!==t.tagName||setTimeout(function(){t.scrollIntoView({behavior:"smooth",block:"center"})},100)}}),console.log("Virtual Viewport API initialized for keyboard handling")):console.log("Visual Viewport API not supported, using fallback")},showMobileHint:function(){if(!window.StorageManager.getItem("mobileHintShown",!1)){var t=document.createElement("div");t.style.cssText="position: fixed; top: 70px; left: 50%; transform: translateX(-50%); background: var(--primary-color); color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000; font-size: 14px; max-width: 90%; text-align: center; animation: slideDown 0.3s ease-out;",t.innerHTML="\ud83d\udca1 \u70b9\u51fb\u5de6\u4e0a\u89d2\u7684 <strong>\u2630</strong> \u6309\u94ae\u53ef\u4ee5\u6253\u5f00\u4fa7\u8fb9\u680f\u83dc\u5355";var e=document.createElement("style");e.textContent="@keyframes slideDown { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }",document.head.appendChild(e),document.body.appendChild(t),setTimeout(function(){t.style.animation="slideUp 0.3s ease-out",t.style.opacity="0",t.style.transform="translateX(-50%) translateY(-20px)",setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t)},300)},3e3),window.StorageManager.setItem("mobileHintShown",!0),console.log("Mobile hint displayed")}}};window.MobileUIState=t}();