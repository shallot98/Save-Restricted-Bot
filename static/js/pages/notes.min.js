!function(){"use strict";window.toggleSidebar=function(){window.MobileUIState.clickSuppressed||window.MobileUIState.toggleSidebar()},window.toggleMobileSidebar=function(){window.MobileUIState.clickSuppressed||window.MobileUIState.toggleSidebar()},window.toggleTheme=function(){const e=document.documentElement,t=e.getAttribute("data-theme");e.setAttribute("data-theme","dark"===t?"":"dark"),window.StorageManager.setItem("theme","dark"===t?"light":"dark")},window.toggleSearch=function(){window.SearchManager.toggleSearch()},window.toggleFilter=function(){window.SearchManager.toggleFilter()},window.toggleUserMenu=function(){console.log("User menu clicked")},window.toggleText=function(e){const t=document.getElementById("text-"+e),n=document.getElementById("expand-"+e);t.classList.contains("expanded")?(t.classList.remove("expanded"),n.textContent="\u5c55\u5f00\u5168\u6587 \u25bc"):(t.classList.add("expanded"),n.textContent="\u6536\u8d77 \u25b2")},window.openImageModal=function(e){window.ModalManager.openImageModal(e)},window.closeImageModal=function(){window.ModalManager.closeImageModal()};const e=window.PerformanceUtils.throttle(function(e,t){window.NetworkManager.fetchWithRetry("/toggle_favorite/"+e,{method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){e.success&&(t.classList.toggle("active"),t.textContent=t.classList.contains("active")?"\u2605":"\u2606")}).catch(function(e){console.error("\u6536\u85cf\u64cd\u4f5c\u5931\u8d25:",e),alert("\u6536\u85cf\u64cd\u4f5c\u5931\u8d25: "+e.message)})},1e3);window.toggleFavorite=function(t,n){e(t,n)};const t=window.PerformanceUtils.throttle(function(e){confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u7b14\u8bb0\u5417?\u6b64\u64cd\u4f5c\u4e0d\u53ef\u64a4\u9500\u3002")&&window.NetworkManager.fetchWithRetry("/delete_note/"+e,{method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw new Error(e.error||"\u5220\u9664\u5931\u8d25");location.reload()}).catch(function(e){console.error("\u5220\u9664\u7b14\u8bb0\u5931\u8d25:",e),alert("\u5220\u9664\u7b14\u8bb0\u5931\u8d25: "+e.message)})},1e3);window.deleteNote=function(e){t(e)};const n=window.PerformanceUtils.throttle(function(e,t,n){const o=window.NetworkManager.detectConnectionType(),i=Math.ceil(t*("slow-2g"===o||"2g"===o?15:10));if(!confirm("\u6821\u51c6\u5c06\u5411\u673a\u5668\u4eba\u53d1\u9001 "+t+" \u4e2a\u78c1\u529b\u94fe\u63a5,\u9884\u8ba1\u9700\u8981\u7ea6 "+i+" \u79d2 ("+o+" \u8fde\u63a5)\u3002\u786e\u5b9a\u7ee7\u7eed?"))return;n.disabled=!0,n.textContent="\u6821\u51c6\u4e2d...";const a="\u6821\u51c6"+(t>1?"("+t+")":""),r=window.NetworkManager.getApiTimeout();Math.min(r*t,6e4);window.NetworkManager.fetchWithRetry("/api/calibrate/"+e,{method:"POST",headers:{"Content-Type":"application/json"}},2).then(function(e){if(!e.ok)throw new Error("HTTP "+e.status+": "+e.statusText);return e.json()}).then(function(e){if(!e.success)throw new Error(e.error||"\u672a\u77e5\u9519\u8bef");alert("\u6821\u51c6\u5b8c\u6210!\n\u603b\u5171: "+e.total+"\n\u6210\u529f: "+e.success_count+"\n\u5931\u8d25: "+e.fail_count),setTimeout(function(){location.reload()},1e3)}).catch(function(e){console.error("\u6821\u51c6\u51fa\u9519:",e),alert("\u6821\u51c6\u5931\u8d25: "+e.message),n.disabled=!1,n.textContent=a})},1e3);window.calibrateNote=function(e,t,o){n(e,t,o)},document.addEventListener("DOMContentLoaded",function(){"dark"===window.StorageManager.getItem("theme","light")&&document.documentElement.setAttribute("data-theme","dark"),window.LazyLoadManager.init(),document.querySelectorAll(".note-text").forEach(function(e){if(e.scrollHeight>120){const t=e.id.replace("text-",""),n=document.getElementById("expand-"+t);n&&(n.style.display="inline-block")}});const e=document.getElementById("sidebar"),t=document.querySelector(".main-content");e&&t&&t.addEventListener("click",function(e){window.MobileUIState.isMobile&&window.MobileUIState.sidebarOpen&&(window.MobileUIState.sidebarOpen=!1,window.MobileUIState.syncDOM(),window.MobileUIState.persist())}),window.MobileUIState.init(),window.SearchManager.initSearchInput(),window.ModalManager.init()}),window.addEventListener("resize",function(){window.MobileUIState.updateViewport()}),window.NetworkManager.init()}();