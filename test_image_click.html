<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡ç‚¹å‡»æµ‹è¯•</title>
    <!-- Tailwind CSS (Local) -->
    <script src="static/js/tailwindcss-3.4.1.js"></script>

    <!-- Alpine.js (Local) -->
    <script defer src="static/js/alpinejs-3.14.3.min.js"></script>
</head>
<body class="bg-gray-50 p-8">
    <h1 class="text-2xl font-bold mb-6">å›¾ç‰‡ç‚¹å‡»åŠŸèƒ½æµ‹è¯•</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- æµ‹è¯•1: å•å›¾ç‰‡ -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-3">æµ‹è¯•1: å•å›¾ç‰‡ç‚¹å‡»</h2>
            <div class="relative aspect-video bg-gray-200 rounded">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect fill='%234f46e5' width='400' height='300'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' fill='white' font-size='24'%3Eç‚¹å‡»æˆ‘%3C/text%3E%3C/svg%3E"
                     alt="Test image"
                     class="w-full h-full object-cover cursor-pointer"
                     onclick="openImageModal(this.src)">
            </div>
            <p class="mt-2 text-sm text-gray-600">ç‚¹å‡»å›¾ç‰‡åº”è¯¥æ‰“å¼€æ”¾å¤§è§†å›¾</p>
        </div>

        <!-- æµ‹è¯•2: å¤šå›¾ç‰‡ -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-3">æµ‹è¯•2: å¤šå›¾ç‰‡ç‚¹å‡»</h2>
            <div class="relative aspect-video bg-gray-200 rounded">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect fill='%2310b981' width='400' height='300'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' fill='white' font-size='24'%3Eå›¾ç‰‡1/2%3C/text%3E%3C/svg%3E"
                     alt="Gallery image"
                     class="w-full h-full object-cover cursor-pointer"
                     onclick="openImageGallery(1, ['data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'300\'%3E%3Crect fill=\'%2310b981\' width=\'400\' height=\'300\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'white\' font-size=\'24\'%3Eå›¾ç‰‡1%3C/text%3E%3C/svg%3E', 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'300\'%3E%3Crect fill=\'%23f59e0b\' width=\'400\' height=\'300\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'white\' font-size=\'24\'%3Eå›¾ç‰‡2%3C/text%3E%3C/svg%3E'])">
                <div class="absolute top-2 right-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded cursor-pointer"
                     onclick="openImageGallery(1, ['data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'300\'%3E%3Crect fill=\'%2310b981\' width=\'400\' height=\'300\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'white\' font-size=\'24\'%3Eå›¾ç‰‡1%3C/text%3E%3C/svg%3E', 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'300\'%3E%3Crect fill=\'%23f59e0b\' width=\'400\' height=\'300\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'white\' font-size=\'24\'%3Eå›¾ç‰‡2%3C/text%3E%3C/svg%3E'])">
                    ğŸ“· 2
                </div>
            </div>
            <p class="mt-2 text-sm text-gray-600">ç‚¹å‡»å›¾ç‰‡æˆ–ç›¸æœºå›¾æ ‡åº”è¯¥æ‰“å¼€ç”»å»Š</p>
        </div>

        <!-- æµ‹è¯•3: ç›´æ¥æŒ‰é’® -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-3">æµ‹è¯•3: ç›´æ¥è°ƒç”¨</h2>
            <button onclick="testFunction()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                æµ‹è¯•åŸºç¡€ç‚¹å‡»äº‹ä»¶
            </button>
            <p class="mt-2 text-sm text-gray-600" id="testResult">ç­‰å¾…ç‚¹å‡»...</p>
        </div>

        <!-- æ§åˆ¶å°æ—¥å¿— -->
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-3">æ§åˆ¶å°æ—¥å¿—</h2>
            <div id="console" class="bg-gray-100 p-3 rounded text-xs font-mono h-40 overflow-y-auto"></div>
        </div>
    </div>

    <!-- å•å›¾ç‰‡æ¨¡æ€æ¡† -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden items-center justify-center p-4" onclick="closeImageModal()">
        <button class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300" onclick="closeImageModal()">Ã—</button>
        <img id="modalImage" class="max-w-full max-h-full object-contain" onclick="event.stopPropagation()">
    </div>

    <!-- å¤šå›¾ç‰‡ç”»å»Š -->
    <div id="galleryModal" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden items-center justify-center p-4" onclick="closeGalleryModal()">
        <button class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300 z-10" onclick="closeGalleryModal()">Ã—</button>
        <div class="relative w-full h-full flex items-center justify-center" onclick="event.stopPropagation()">
            <img id="galleryImage" class="max-w-full max-h-full object-contain">

            <button id="galleryPrev" onclick="changeGalleryImage(-1)" class="absolute left-4 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-3 rounded-full">â†</button>
            <button id="galleryNext" onclick="changeGalleryImage(1)" class="absolute right-4 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-3 rounded-full">â†’</button>

            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black bg-opacity-60 text-white px-4 py-2 rounded-full text-sm">
                <span id="galleryCounter">1 / 1</span>
            </div>
        </div>
    </div>

    <script>
        // æ—¥å¿—è¾“å‡ºå‡½æ•°
        function log(message) {
            const consoleDiv = document.getElementById('console');
            const time = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `[${time}] ${message}<br>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(message);
        }

        // æµ‹è¯•å‡½æ•°
        function testFunction() {
            log('âœ… åŸºç¡€ç‚¹å‡»äº‹ä»¶å·¥ä½œæ­£å¸¸');
            document.getElementById('testResult').textContent = 'âœ… ç‚¹å‡»æˆåŠŸ!';
            document.getElementById('testResult').className = 'mt-2 text-sm text-green-600 font-semibold';
        }

        // å•å›¾ç‰‡æ¨¡æ€æ¡†
        function openImageModal(src) {
            log('è°ƒç”¨ openImageModal: ' + src.substring(0, 50) + '...');
            const modal = document.getElementById('imageModal');
            const img = document.getElementById('modalImage');

            if (!modal) {
                log('âŒ é”™è¯¯: imageModal å…ƒç´ ä¸å­˜åœ¨');
                return;
            }
            if (!img) {
                log('âŒ é”™è¯¯: modalImage å…ƒç´ ä¸å­˜åœ¨');
                return;
            }

            img.src = src;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';

            log('âœ… å•å›¾ç‰‡æ¨¡æ€æ¡†å·²æ‰“å¼€');
        }

        function closeImageModal() {
            log('è°ƒç”¨ closeImageModal');
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = '';
            log('âœ… å•å›¾ç‰‡æ¨¡æ€æ¡†å·²å…³é—­');
        }

        // å¤šå›¾ç‰‡ç”»å»Š
        let galleryImages = [];
        let currentGalleryIndex = 0;

        function openImageGallery(noteId, mediaPaths) {
            log('è°ƒç”¨ openImageGallery: noteId=' + noteId + ', å›¾ç‰‡æ•°=' + mediaPaths.length);

            const modal = document.getElementById('galleryModal');
            if (!modal) {
                log('âŒ é”™è¯¯: galleryModal å…ƒç´ ä¸å­˜åœ¨');
                return;
            }

            galleryImages = mediaPaths;
            currentGalleryIndex = 0;
            showGalleryImage(0);

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';

            log('âœ… ç”»å»Šå·²æ‰“å¼€');
        }

        function closeGalleryModal() {
            log('è°ƒç”¨ closeGalleryModal');
            const modal = document.getElementById('galleryModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = '';
            log('âœ… ç”»å»Šå·²å…³é—­');
        }

        function showGalleryImage(index) {
            if (index < 0 || index >= galleryImages.length) return;

            currentGalleryIndex = index;
            const img = document.getElementById('galleryImage');
            img.src = galleryImages[index];

            document.getElementById('galleryCounter').textContent = `${index + 1} / ${galleryImages.length}`;

            document.getElementById('galleryPrev').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('galleryNext').style.display = index === galleryImages.length - 1 ? 'none' : 'block';

            log('æ˜¾ç¤ºå›¾ç‰‡ ' + (index + 1) + ' / ' + galleryImages.length);
        }

        function changeGalleryImage(direction) {
            const newIndex = currentGalleryIndex + direction;
            if (newIndex >= 0 && newIndex < galleryImages.length) {
                showGalleryImage(newIndex);
            }
        }

        log('é¡µé¢åŠ è½½å®Œæˆï¼Œæ‰€æœ‰å‡½æ•°å·²å®šä¹‰');
    </script>
</body>
</html>
