# 多张图片显示功能测试指南

## 🎯 测试目标
验证笔记系统能够正确显示和浏览包含多张图片的笔记。

---

## 📊 测试数据

### 数据库中的多图片笔记统计
- **总笔记数：** 690 条
- **多图片笔记数：** 34 条
- **最近的多图片笔记 ID：** 862, 861, 860

### 示例多图片笔记

#### 笔记 ID: 862
- **图片数量：** 2 张
- **图片路径：**
  1. `webdav:1929_0_20251213_104810.jpg`
  2. `webdav:1930_1_20251213_104819.jpg`

#### 笔记 ID: 861
- **图片数量：** 2 张

#### 笔记 ID: 860
- **图片数量：** 2 张

---

## 🧪 测试步骤

### 1. 访问笔记列表
```
URL: http://localhost:10000/notes
```

### 2. 查找多图片笔记
在笔记列表中，多图片笔记会显示：
- ✅ 第一张图片作为封面
- ✅ 右上角显示 "📷 2" 或 "📷 3" 等标记

### 3. 测试图片画廊

#### 3.1 打开画廊
- **方法 1：** 点击图片封面
- **方法 2：** 点击右上角的图片数量标记

**预期结果：**
- 全屏黑色背景
- 显示第一张图片
- 底部显示 "1 / 2" 计数器
- 底部显示缩略图导航栏

#### 3.2 切换图片
**方法 1：使用按钮**
- 点击左侧按钮 ← 查看上一张
- 点击右侧按钮 → 查看下一张

**方法 2：使用键盘**
- 按 `←` 左箭头键查看上一张
- 按 `→` 右箭头键查看下一张
- 按 `Esc` 键关闭画廊

**方法 3：点击缩略图**
- 点击底部任意缩略图直接跳转

**预期结果：**
- 图片平滑切换
- 计数器更新（如 "2 / 2"）
- 当前缩略图高亮显示（白色边框）
- 首尾图片时对应的切换按钮隐藏

#### 3.3 关闭画廊
**方法 1：** 点击右上角 × 按钮
**方法 2：** 按 `Esc` 键
**方法 3：** 点击图片外的黑色背景区域

---

## ✅ 功能检查清单

### 基础显示
- [ ] 多图片笔记显示第一张图片
- [ ] 右上角显示正确的图片数量
- [ ] 图片数量标记可点击
- [ ] 单图片笔记不显示数量标记

### 画廊功能
- [ ] 点击图片打开画廊
- [ ] 画廊全屏显示
- [ ] 图片居中显示
- [ ] 计数器显示正确

### 导航功能
- [ ] 左右切换按钮工作正常
- [ ] 键盘快捷键工作正常
- [ ] 缩略图点击工作正常
- [ ] 首尾按钮正确隐藏

### 视觉效果
- [ ] 当前缩略图高亮显示
- [ ] 其他缩略图半透明
- [ ] 切换动画流畅
- [ ] 暗色背景不刺眼

### 关闭功能
- [ ] × 按钮关闭画廊
- [ ] Esc 键关闭画廊
- [ ] 点击背景关闭画廊

---

## 🔍 调试信息

### 查看笔记数据
```bash
# 在容器中查询多图片笔记
docker exec save-restricted-bot python3 -c "
from database import get_notes
notes = get_notes(limit=50)
for note in notes:
    if note.get('media_paths') and len(note.get('media_paths', [])) > 1:
        print(f'ID: {note[\"id\"]}, 图片数: {len(note[\"media_paths\"])}')
"
```

### 查看浏览器控制台
打开浏览器开发者工具（F12），检查：
1. **Console 标签页** - 查看 JavaScript 错误
2. **Network 标签页** - 查看图片加载情况
3. **Elements 标签页** - 检查 HTML 结构

### 常见问题排查

#### 问题 1：看不到图片数量标记
**可能原因：**
- 笔记只有一张图片
- `media_paths` 数据为空

**解决方法：**
```bash
# 查找确实有多张图片的笔记
docker exec save-restricted-bot python3 -c "
from database import get_note_by_id
note = get_note_by_id(862)
print(f'图片数量: {len(note.get(\"media_paths\", []))}')
print(f'图片路径: {note.get(\"media_paths\")}')
"
```

#### 问题 2：点击图片没有反应
**可能原因：**
- JavaScript 未加载
- 函数名称错误

**解决方法：**
1. 打开浏览器控制台查看错误
2. 检查 `openImageGallery` 函数是否存在
3. 刷新页面清除缓存（Ctrl+F5）

#### 问题 3：图片无法加载
**可能原因：**
- WebDAV 连接问题
- 图片路径错误

**解决方法：**
```bash
# 检查 WebDAV 连接
curl -s http://localhost:10000/health | grep storage

# 查看容器日志
docker compose logs --tail=50 | grep -i error
```

---

## 📱 移动端测试

### 测试设备
- iOS Safari
- Android Chrome
- 平板设备

### 移动端特性
- [ ] 触摸滑动切换图片（如果实现）
- [ ] 缩略图在小屏幕上可滚动
- [ ] 按钮大小适合触摸
- [ ] 全屏显示正常

---

## 🎨 视觉效果测试

### 亮色模式
- [ ] 图片清晰显示
- [ ] 标记颜色对比度好
- [ ] 缩略图边框清晰

### 暗色模式
- [ ] 切换到暗色模式（点击顶部月亮图标）
- [ ] 画廊背景适配
- [ ] 按钮颜色适配
- [ ] 文字清晰可读

---

## 📊 性能测试

### 加载速度
- [ ] 图片封面加载快速
- [ ] 画廊打开响应迅速
- [ ] 切换图片无明显延迟

### 内存使用
- [ ] 打开多个画廊不卡顿
- [ ] 关闭画廊释放资源
- [ ] 长时间使用无内存泄漏

---

## 🐛 已知问题

### 当前版本无已知问题
如果发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 浏览器版本
4. 错误信息（控制台截图）

---

## 📝 测试报告模板

```
测试日期：2025-12-13
测试人员：[姓名]
浏览器：[Chrome/Firefox/Safari] [版本号]

测试结果：
✅ 基础显示功能正常
✅ 画廊打开/关闭正常
✅ 图片切换功能正常
✅ 键盘快捷键正常
✅ 缩略图导航正常
✅ 暗色模式适配正常

发现问题：
[无] 或 [问题描述]

建议改进：
[建议内容]
```

---

## 🚀 下一步

测试通过后，可以：
1. 测试搜索高亮功能
2. 测试其他新功能
3. 进行压力测试
4. 收集用户反馈

---

**测试愉快！** 🎉

如有问题，请查看：
- `FEATURE_IMPLEMENTATION_SUMMARY.md` - 功能实现详情
- `DEPLOYMENT_REPORT.md` - 部署报告
- 容器日志：`docker compose logs -f`
